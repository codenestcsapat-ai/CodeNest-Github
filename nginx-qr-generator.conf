# ===================================================================
# NGINX CACHING CONFIGURATION FOR QR-GENERATOR.HTML
# CodeNest - Optimized for Lighthouse Performance
# ===================================================================

# ===================================================================
# GZIP COMPRESSION
# ===================================================================
gzip on;
gzip_vary on;
gzip_proxied any;
gzip_comp_level 6;
gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/json
    application/javascript
    application/x-javascript
    application/xml
    image/svg+xml;

# ===================================================================
# BROTLI COMPRESSION (if ngx_brotli module is available)
# ===================================================================
# brotli on;
# brotli_comp_level 6;
# brotli_types
#     text/plain
#     text/css
#     text/xml
#     text/javascript
#     application/json
#     application/javascript
#     application/x-javascript
#     application/xml
#     image/svg+xml;

# ===================================================================
# STATIC ASSETS CACHING - 1 YEAR WITH IMMUTABLE
# ===================================================================

# JavaScript files
location ~* \.(js)$ {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header X-Content-Type-Options "nosniff";
    access_log off;
}

# CSS files
location ~* \.(css)$ {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header X-Content-Type-Options "nosniff";
    access_log off;
}

# Images
location ~* \.(jpg|jpeg|png|gif|webp|svg|ico)$ {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header X-Content-Type-Options "nosniff";
    access_log off;
}

# Fonts
location ~* \.(woff|woff2|ttf|otf|eot)$ {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header X-Content-Type-Options "nosniff";
    access_log off;
}

# ===================================================================
# SPECIFIC FILE CACHING (script.js, qr_app.js, etc.)
# ===================================================================
location ~ ^/(script\.js|qr_app\.js|cookie-consent\.js)$ {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header X-Content-Type-Options "nosniff";
    access_log off;
}

location ~ ^/(styles\.css|qr_style\.css|cookie-consent\.css)$ {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header X-Content-Type-Options "nosniff";
    access_log off;
}

location ~ ^/(logo_png\.png|logo_footer-modified\.png)$ {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header X-Content-Type-Options "nosniff";
    access_log off;
}

# ===================================================================
# HTML FILES - NO CACHING (Always Fresh)
# ===================================================================
location ~* \.(html|htm)$ {
    expires -1;
    add_header Cache-Control "no-cache, no-store, must-revalidate";
    add_header Pragma "no-cache";
}

# ===================================================================
# SECURITY HEADERS
# ===================================================================
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# ===================================================================
# MIME TYPES
# ===================================================================
types {
    image/webp webp;
    application/javascript js;
    text/css css;
}

# ===================================================================
# FULL SERVER BLOCK EXAMPLE
# ===================================================================
# server {
#     listen 80;
#     listen [::]:80;
#     server_name codenest.hu www.codenest.hu;
#     root /var/www/codenest.hu;
#     index index.html;
#
#     # Enable gzip
#     gzip on;
#     gzip_vary on;
#     gzip_proxied any;
#     gzip_comp_level 6;
#     gzip_types text/plain text/css text/xml text/javascript application/json application/javascript application/x-javascript application/xml image/svg+xml;
#
#     # Static assets - 1 year caching
#     location ~* \.(js|css|jpg|jpeg|png|gif|webp|svg|ico|woff|woff2|ttf|otf|eot)$ {
#         expires 1y;
#         add_header Cache-Control "public, max-age=31536000, immutable";
#         add_header X-Content-Type-Options "nosniff";
#         access_log off;
#     }
#
#     # HTML - no caching
#     location ~* \.(html|htm)$ {
#         expires -1;
#         add_header Cache-Control "no-cache, no-store, must-revalidate";
#         add_header Pragma "no-cache";
#     }
#
#     # Security headers
#     add_header X-Frame-Options "SAMEORIGIN" always;
#     add_header X-Content-Type-Options "nosniff" always;
#     add_header X-XSS-Protection "1; mode=block" always;
#     add_header Referrer-Policy "strict-origin-when-cross-origin" always;
#
#     # Main location
#     location / {
#         try_files $uri $uri/ =404;
#     }
# }

# ===================================================================
# USAGE INSTRUCTIONS
# ===================================================================
# OPTION 1: Add to existing nginx.conf or site configuration
# - Copy the relevant location blocks into your server block
# - Reload nginx: sudo nginx -t && sudo systemctl reload nginx
#
# OPTION 2: Include this file in your server block
# - Add to your server block: include /path/to/nginx-qr-generator.conf;
# - Reload nginx: sudo nginx -t && sudo systemctl reload nginx
#
# TESTING:
# - curl -I https://yourdomain.com/script.js
# - Verify: Cache-Control: public, max-age=31536000, immutable
#
# VERIFICATION:
# - Check browser DevTools Network tab
# - Look for "from disk cache" or "from memory cache"
# - Verify response headers contain immutable flag
# ===================================================================
